CLAUSULA GROUP BY e HAVING

Introdução 

- A instrução SELECT possui as cláusulas GROUP BY e HAVING .

- GROUP BY organiza dados em grupos para produzir sumários, enquanto HAVING estabelece condições para listar esses grupos .

- A cláusula HAVING está para GROUP BY assim como WHERE está para SELECT .

Revisão Função de Grupo 

- Funções de grupo resumem informações através de grupos de linhas .

- Funções como SUM, AVG, COUNT, MAX e MIN operam sobre um número de linhas, sendo funções de GRUPO .

- DISTINCT considera valores não duplicados, ALL considera todos os valores e sua declaração não é necessária .

Funções de Grupo Específicas 

- AVG retorna a média aritmética de um grupo de registros; exemplo: AVG(SALARY) .

- Min, Max e Sum retornam o menor valor, o maior valor e a soma de um grupo de registros, respectivamente .

- Uma função de grupo pode ser usada para subconjunto de linhas de uma tabela usando a cláusula WHERE .

Count 

- Count retorna a quantidade de registros de um grupo; exemplo: COUNT(*) .

- Para encontrar o número de empregados do departamento 30, usar SELECT Count(*) FROM Employees WHERE Department_ID = 30 .

- WHERE Department_ID = 30 .

Cláusula GROUP BY 

- Todos os campos no SELECT que não possuírem função de grupo DEVEM APARECER NA CLÁUSULA GROUP BY .

- Os campos existentes na cláusula GROUP BY não precisam aparecer no SELECT .

- Para calcular a média salarial de cada grupo de cargo, usar SELECT Department_ID, AVG(Salary) FROM Employees Group by Department_ID Order by Department_ID .

Agrupando Mais que uma Coluna 

- É possível efetuar o agrupamento por departamento e salários .

- Exemplo: SELECT department_id dept_id, job_id, SUM(salary) FROM employees GROUP BY department_id, job_id .

- Não se usa a cláusula WHERE para restringir grupos; para restringir grupos, usa-se a cláusula HAVING .

Excluindo Linhas Quando Estiver Usando o GROUP BY 

- Linhas devem ser excluídas com a cláusula WHERE antes da divisão por grupos .

- Não se pode usar funções de grupo na cláusula WHERE .

- Exemplo: SELECT Department_ID, AVG(Salary) FROM Employees WHERE Department_ID Not in (10,20,30) GROUP BY Department_ID ORDER BY Department_ID .

Restringindo o Resultado por Grupo 

- A Figura anterior está restringindo o resultado quando o salário máximo por departamento seja maior que 10.000 .

- Use a cláusula HAVING se você quiser especificar qual grupo será mostrado .

- A cláusula WHERE é condição para o SELECT; A cláusula HAVING é condição para um GROUP BY .

A Cláusula HAVING 

- Use a cláusula HAVING para especificar qual grupo será mostrado .

- Para mostrar a média salarial de todos os departamentos que tenham a média maior que 6000, faça: SELECT Department_ID, AVG(Salary) FROM Employees GROUP BY Department_ID HAVING AVG(Salary) > 6000 ORDER BY Department_ID .

- Para mostrar a quantidade de empregados que tenham o salário acima de 10000 por departamento, usar HAVING .

Saiba Mais 

- A cláusula HAVING deve ser colocada depois da cláusula GROUP BY e é utilizada para estabelecer condições dentro das funções de grupo .

- A cláusula WHERE não pode ser usada para restringir itens de grupo .

- A seguinte declaração da cláusula WHERE é errada .

Ordem das Cláusulas na Declaração SELECT 

- A ordem das cláusulas na declaração SELECT é importante .

- A ordem correta é: SELECT, FROM, WHERE, GROUP BY, HAVING, ORDER BY .

- Exemplo: SELECT coluna(s) FROM tabela(s) WHERE condição linha GROUP BY coluna(s) HAVING condição de grupo de linhas ORDER BY coluna(s) .

